package view;

import business.recursoshumanos.IPermissions;
import business.recursoshumanos.PermissionsFactory;
import data_access.SGHabitat;
import view.recursoshumanos.Voluntarios;
import java.beans.PropertyVetoException;
import java.io.IOException;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.logging.Level;
import java.util.logging.Logger;
import javax.swing.JInternalFrame;
import javax.swing.JOptionPane;

/**Menu principal da aplicação, o utilizador é reencaminhado para este Menu log após efetuar o login.
 *
 * @author Jorge Caldas, José Cortez, Marcelo Gonçalves, Ricardo Silva
 * @version 2014.15.12
 * @version 2015.01.06
 * 
 */

public final class MainMenu extends javax.swing.JFrame {

    // Variáveis de instância
    private SGHabitat hfacade;
    private List<String> openedFrames;    
    
    public MainMenu(){
        initComponents();
    }
    
    /**
     * Construtor acessível pela frame de autenticação na aplicação.
     * @param facade, facade do sistema de gestão da Habitat
     * @throws IOException 
     */
    public MainMenu(SGHabitat facade) throws IOException {
        initComponents();
        this.setLocationRelativeTo(null);
        openedFrames = new ArrayList<>();
        this.hfacade=facade;
        this.setTitle("GestHabitat:"+hfacade.rh_getUsername());
        this.infoPanel.setText("\nBem-vindo!\n"+hfacade.rh_getUsername()+"\n"+this.getCurrentDateTime()+"\n");
    }

    /**
     * Método que devolve tempo atual do sistema.
     * @return string com date e hora corrente do sistema. 
     */
    public String getCurrentDateTime(){
        DateFormat dateFormat = new SimpleDateFormat("yyyy/MM/dd HH:mm:ss");
        Date date = new Date();
        return dateFormat.format(date);
    }
    
    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        panel1 = new java.awt.Panel();
        vButton = new javax.swing.JButton();
        fButton = new javax.swing.JButton();
        ddButton = new javax.swing.JButton();
        oButton = new javax.swing.JButton();
        sButton = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        logoutButton = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        infoPanel = new javax.swing.JTextArea();
        desktop = new javax.swing.JDesktopPane();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();

        setDefaultCloseOperation(javax.swing.WindowConstants.DO_NOTHING_ON_CLOSE);
        setTitle("GestHabitat");

        vButton.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\voluntarios_icon.png")); // NOI18N
        vButton.setText("     Voluntários");
        vButton.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        vButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                onClickVoluntarios(evt);
            }
        });

        fButton.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\familia_icon.png")); // NOI18N
        fButton.setText("        Famílias");
        fButton.setToolTipText("");
        fButton.setEnabled(false);
        fButton.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        fButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                onClickFamilias(evt);
            }
        });

        ddButton.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\doacoes_icon.png")); // NOI18N
        ddButton.setText("       Doações");
        ddButton.setToolTipText("");
        ddButton.setActionCommand("        Doações");
        ddButton.setEnabled(false);
        ddButton.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);

        oButton.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\obras_icon.png")); // NOI18N
        oButton.setText("        Obras");
        oButton.setEnabled(false);
        oButton.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);

        sButton.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\stock_icon.png")); // NOI18N
        sButton.setText("        Stock");
        sButton.setToolTipText("");
        sButton.setEnabled(false);
        sButton.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);

        jButton1.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\evento_icon.png")); // NOI18N
        jButton1.setText("         Eventos");
        jButton1.setToolTipText("");
        jButton1.setEnabled(false);
        jButton1.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);

        logoutButton.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\logout_icon.png")); // NOI18N
        logoutButton.setText("        Saír");
        logoutButton.setHorizontalAlignment(javax.swing.SwingConstants.LEFT);
        logoutButton.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                onClickLogoutButton(evt);
            }
        });

        infoPanel.setColumns(20);
        infoPanel.setRows(5);
        jScrollPane2.setViewportView(infoPanel);

        javax.swing.GroupLayout panel1Layout = new javax.swing.GroupLayout(panel1);
        panel1.setLayout(panel1Layout);
        panel1Layout.setHorizontalGroup(
            panel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addComponent(sButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(oButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(ddButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(fButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(vButton, javax.swing.GroupLayout.Alignment.TRAILING, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jButton1, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(logoutButton, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
            .addComponent(jScrollPane2, javax.swing.GroupLayout.DEFAULT_SIZE, 210, Short.MAX_VALUE)
        );
        panel1Layout.setVerticalGroup(
            panel1Layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(panel1Layout.createSequentialGroup()
                .addComponent(vButton, javax.swing.GroupLayout.PREFERRED_SIZE, 61, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(fButton, javax.swing.GroupLayout.PREFERRED_SIZE, 64, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(ddButton, javax.swing.GroupLayout.PREFERRED_SIZE, 59, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(oButton, javax.swing.GroupLayout.PREFERRED_SIZE, 60, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(sButton, javax.swing.GroupLayout.PREFERRED_SIZE, 57, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jButton1, javax.swing.GroupLayout.PREFERRED_SIZE, 57, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(logoutButton, javax.swing.GroupLayout.PREFERRED_SIZE, 57, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 85, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );

        desktop.setBackground(new java.awt.Color(255, 255, 255));
        desktop.setBorder(javax.swing.BorderFactory.createLineBorder(new java.awt.Color(0, 153, 204)));
        desktop.setToolTipText("");

        jLabel3.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\habitat_background.png")); // NOI18N
        jLabel3.setHorizontalTextPosition(javax.swing.SwingConstants.CENTER);

        jLabel4.setText("<html>\n<b>Artigo 65º</b> <br/>\n<i>(Habitação e Urbanismo)</i> <br/>\n\n1. Todos têm direito, para si e para a sua família, a uma habitação de dimensão adequada, em<br/> condições de higiene e conforto e que preserve a intimidade pessoal e a privacidade familiar. <br/>\n<br/>\n<i>Constituição da República Portuguesa</i>\n</html>");

        javax.swing.GroupLayout desktopLayout = new javax.swing.GroupLayout(desktop);
        desktop.setLayout(desktopLayout);
        desktopLayout.setHorizontalGroup(
            desktopLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(desktopLayout.createSequentialGroup()
                .addGroup(desktopLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(desktopLayout.createSequentialGroup()
                        .addContainerGap()
                        .addComponent(jLabel4, javax.swing.GroupLayout.PREFERRED_SIZE, 298, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(desktopLayout.createSequentialGroup()
                        .addContainerGap(151, Short.MAX_VALUE)
                        .addComponent(jLabel3)))
                .addContainerGap(151, Short.MAX_VALUE))
        );
        desktopLayout.setVerticalGroup(
            desktopLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(desktopLayout.createSequentialGroup()
                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel3, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                .addComponent(jLabel4, javax.swing.GroupLayout.PREFERRED_SIZE, 152, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap())
        );
        desktop.setLayer(jLabel3, javax.swing.JLayeredPane.DEFAULT_LAYER);
        desktop.setLayer(jLabel4, javax.swing.JLayeredPane.DEFAULT_LAYER);

        jLabel1.setIcon(new javax.swing.ImageIcon("D:\\Dropbox\\Dropbox\\BD e DSS\\GUI\\icons\\habitat_logo.png")); // NOI18N
        jLabel1.setLabelFor(jLabel2);

        jLabel2.setText("V1.0.0");

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(10, 10, 10)
                        .addComponent(panel1, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 216, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(35, 35, 35)
                        .addComponent(jLabel2, javax.swing.GroupLayout.PREFERRED_SIZE, 89, javax.swing.GroupLayout.PREFERRED_SIZE)))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(desktop)
                .addContainerGap())
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addContainerGap()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addComponent(desktop)
                    .addGroup(layout.createSequentialGroup()
                        .addComponent(jLabel1, javax.swing.GroupLayout.PREFERRED_SIZE, 80, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(jLabel2)
                        .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                        .addComponent(panel1, javax.swing.GroupLayout.PREFERRED_SIZE, 543, javax.swing.GroupLayout.PREFERRED_SIZE)
                        .addGap(0, 0, Short.MAX_VALUE)))
                .addContainerGap())
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void onClickVoluntarios(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_onClickVoluntarios
        IPermissions p = new PermissionsFactory().createPermissions();
        List<String> perms = new ArrayList<>();
        perms.add(p.getVconsult());
        if(this.hfacade.rh_funHasPermissions(perms)){
            JInternalFrame v = new Voluntarios(this,hfacade);
            if(!this.openedFrames.contains(v.getClass().getSimpleName())){ // Verificar se já não está aberta
                this.openedFrames.add(v.getClass().getSimpleName());
                desktop.add(v);
                v.show();
                v.setClosable(true);
                try {
                    v.setMaximum(true); // Maximizar a frame interior
                } catch (PropertyVetoException e) {}
            }
        } else{ new NoPermissionsDialog(this).show(); }
    }//GEN-LAST:event_onClickVoluntarios

    private void onClickFamilias(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_onClickFamilias

    }//GEN-LAST:event_onClickFamilias

    private void onClickLogoutButton(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_onClickLogoutButton
        int option = JOptionPane.showConfirmDialog(null, "Tem a certeza que pretende saír da GestHabitat?", "Saír", JOptionPane.YES_NO_OPTION);
        if (option == JOptionPane.YES_OPTION){
            try {
                this.hfacade.closeDataBaseConnections();
                this.dispose();
            } catch (Exception ex) {
                Logger.getLogger(JCloseIFrameListener.class.getName()).log(Level.SEVERE, null, ex);
            }
        }
    }//GEN-LAST:event_onClickLogoutButton

    /**
     * Método que imprime relatórios de operações no painel do menu principal.
     * @param text, texto com informação acerca de alguma operação efetuada na operação. 
     */
    public void report (String text){
        StringBuilder sb = new StringBuilder();
        sb.append(this.infoPanel.getText());
        sb.append("\n").append(text);
        this.infoPanel.setText(sb.toString());
    }
    
    /**
     * Método que fornece primeiro e último nome do funcionário com sessão iniciada.
     * @return primeiro e último nome do funcionário.
     */
    public String getNomeFuncionario(){return this.hfacade.rh_getFuShortName();}
    
    /**
     * Permite controlar o fecho de frames interiores e poder reabri-las novamente.
     * @param className, nome da classe da frame que foi fechada. 
     */
    public void internalMainFrameCloseHandler(String className){this.openedFrames.remove(className);}
    
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException | InstantiationException | IllegalAccessException | javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(MainMenu.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            @Override
            public void run() {
                new MainMenu().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton ddButton;
    private javax.swing.JDesktopPane desktop;
    private javax.swing.JButton fButton;
    private javax.swing.JTextArea infoPanel;
    private javax.swing.JButton jButton1;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JButton logoutButton;
    private javax.swing.JButton oButton;
    private java.awt.Panel panel1;
    private javax.swing.JButton sButton;
    private javax.swing.JButton vButton;
    // End of variables declaration//GEN-END:variables
}
